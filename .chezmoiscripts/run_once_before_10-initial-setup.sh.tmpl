#!/usr/bin/env bash
set -euo pipefail

echo "ğŸš€ Starting initial environment setup..."

{{ if eq .chezmoi.os "linux" }}
    {{ if eq .chezmoi.osRelease.id "fedora" }}
        echo "ğŸ“¦ Installing Fedora dependencies..."
        sudo dnf update -y && sudo dnf install -y curl git @development-tools

    {{ else if eq .chezmoi.osRelease.idLike "debian" }}
        echo "ğŸ“¦ Installing Debian/Ubuntu dependencies..."
        sudo apt update -y && sudo apt install -y curl git build-essential

    {{ else if eq .chezmoi.osRelease.idLike "arch" }}
        echo "ğŸ“¦ Installing Arch dependencies..."
        sudo pacman -Syu --noconfirm --needed curl git base-devel

    {{ else }}
        echo "âš ï¸ Warning: Unknown Linux distribution. Skipping system deps."
    {{ end }}
{{ end }}

if ! command -v {{ .brewPath }}/brew >/dev/null 2>&1; then
    echo "ğŸº Installing Homebrew..."
    NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
else
    echo "âœ… Homebrew already installed."
fi

eval "$({{ .brewPath }}/brew shellenv)"

echo "ğŸ”§ Installing core tools for mise..."
brew install node go rust age mise

echo "âœ… Initial setup complete!"
